---
title: "Introducción al Diseño de experimentos"
author: "Kevin Palomino"
date: "2024-01-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<div style="text-align: justify">

El diseño de experimentos es una metodología fundamental en la investigación científica que busca establecer relaciones causales entre variables. Al planificar y ejecutar un experimento, se pretende controlar y manipular las condiciones bajo las cuales ocurren los fenómenos de interés, con el fin de obtener conclusiones válidas y confiables. A través de la adecuada selección y disposición de las variables, así como la aplicación de técnicas estadísticas apropiadas, el diseño experimental permite explorar y entender de manera sistemática el comportamiento de los sistemas estudiados. En este contexto, la precisión en la formulación y ejecución del diseño es esencial para garantizar la validez y la generalización de los resultados obtenidos.ß

<div/>

# Contenido

1.  ¿Qué es el Diseño de Experimentos (DOE)?

2.  Conceptos básicos.

3.  Principios básicos.

4.  Etapas del Diseño de Experimentos.

5.  Repaso

# 1. ¿Qué es el Diseño de Experimentos (DOE)?

::: {style="text-align:center"}
![](images/QDOE.png){width="497"}
:::

## 1.1 Objetivos del Diseño de Experimentos

-   ***Relevancia***: Determinarr los factores significativos

-   ***Optimización***: Fijar condiciones de operación

-   ***Variabilidad***: Diseñar un proceso robusto

-   ***Modelación***: Construir modelos de regresión

# 2. Conceptos básicos

-   ***Experimento***: Cambio en las condiciones de operación de un sistema con el objetivo de medir el efecto de dicho cambio en la respuesta.

-   ***Unidad experimental***: Pieza(s) o muestra(s) que se utiliza para generar una medición de la respuesta.

-   ***Variable de respuesta***: Variable a optimizar y que depende potencialmente de los factores. No es controlada por el experimentador.

-   ***Factores***: Fenómenos que potencialmente causan variación y que se pueden fijar en un valor dado.

-   ***Niveles de factores***: Valores que un factor puede tomar. Pueden ser categóricos o numéricos.

-   ***Tratamiento***: Combinación de niveles de todos los factores involucrados en el experimento.

-   ***Iteracción*****:** Impacto en la respuesta por el cambio de un factor influido por la presencia de otro.

-   ***Corrida experimental***: Cada ejecución del experimento bajo un tratamiento para tener una medición de la variable de respuesta.

-   ***Réplica***: Todas las corridas experimentales con la misma combinación de niveles (tratamientos).

-   ***Experimento balanceado***: Experimento en que todos los niveles de cada factor aparece el mismo número de veces en las corridas.

-   ***Error aleatorio***: Variabilidad de la respuesta que no está explicada por los factores del experimento.

# 3. Principios básicos

::: {style="text-align:center"}
![](images/PDOE.png){width="641"}
:::

# 4. Etapas del Diseño de Experimentos

::: {style="text-align:center"}
![](images/EDOE.png){width="482"}
:::

# 5. Repaso:

## 5.1 Distribución de probabilidades

### 5.1.1 Muestras grandes

<div style="text-align: justify">

Sea $\overline{x}$ la media de una muestra aleatoria de tamaño n selecionada de una población con media $\mu$ y varianza $\sigma^2>0$. Supongamos que se cumple alguna de las siguientes condiciones:

<div/>

(a) La población es normal y $\sigma^2$ es conocida (No importa el tamaño de n).
(b) La población es normal y $\sigma^2$ es desconocida y $n\geq30$.
(c) La forma de La población es desconocida (o no normal), $\sigma^2$ es conocida o desconocida y $n\geq30$.

Entonces, la distribución muestral de la media muestral $\overline{x}$ es normal con media $\mu_{\overline{x}}$ y varianza $\sigma_{\overline{x}}^2$, calculadas a partir de la siguiente formula:

$$Z=\frac{\overline{x}-\mu_{\overline{x}}}{\sigma_{\overline{x}}} $$

### 5.1.2 Muestras pequeñas

Si el muestro se hace en una población normal con varianza desconocida y si las muestras seleccionadas son de tamaño $n < 30$, entonces, la distribución muestral de la media muestral $\overline{x}$ es la de $t$ de $Student$ con $n-1$ grados de libertad. Por lo tanto, se utiliza la siguiente expresión:

$$ t = \frac{\overline{x}-\mu_{\overline{x}}}{\sigma_{\overline{x}}}$$

***Resumen***

::: {style="text-align:center"}
![](images/SDOE.png){width="626"}
:::

***Algunas observaciones para la media varianza muestrales***

::: {style="text-align:center"}
![](images/FDOE.png){width="520"}
:::

### 5.1.3 Ejemplos

Antes de iniciar a revolver algunos ejemplos, les presento algunas funciones utiles para obtener los graficas y las probabilidades

```{r funciones, echo=TRUE}

## Funciones para graficar la probabilidad
normal_area <- function(mean = 0, sd = 1, lb, ub, acolor = "lightgray", ...) {
  x <- seq(mean - 3 * sd, mean + 3 * sd, length = 100) 
  if (missing(lb)) {
    lb <- min(x)
  }
  if (missing(ub)) {
    ub <- max(x)
  }
  x2 <- seq(lb, ub, length = 100)    
  plot(x, dnorm(x, mean, sd), type = "n", ylab = "")
  y <- dnorm(x2, mean, sd)
  polygon(c(lb, x2, ub), c(0, y, 0), col = acolor)
  lines(x, dnorm(x, mean, sd), type = "l", ...)
}

## Funcion para t-stundet
ts<-function(x,media,sd){
  (x-media)/sd
}
```

#### 5.1.3.1 Ejemplo 1

<div style="text-align: justify">

Suponga que el incremento porcentual de los salarios de los funcionarios de todas las corporaciones medianas se distribuye siguiendo una distribución normal con media 12.2% y desviación típica 3.6%. Si se toma una muestra aleatoria de nueve observaciones de esta población según los incrementos porcentuales de salario, ¿cuál es la probabilidad de que la media muestra sea mayor que 10%?

**Datos**

Media muestral: 12.2

Desviación: 3.6

n: 9

Distribución: Normal

**Solución**

-   **Paso 1**: revisamos los supuestos, esto es:

-   La distribución de probabilidad es normal? : **Si**

-   La varianza poblacional es conocida? : **No**

-   El tamaño de la muestra es grande: **Si**

Por lo tanto, suponemos que $\overline{x}$ se distribuye con una distribución normal con

$$Z=\frac{\overline{x}-\mu_{\overline{x}}}{\sigma_{\overline{x}}} $$

-   **Paso 2**: Construimos la probabilidad solicitada, esto es:

$$P(X>10)$$

-   **Paso 3**: Usamos las funciones declaradas anteriormente, y el siguiente código:

<div/>

```{r Ejemplo1, echo=TRUE}

#Ejemplo 1

media=12.2 # Ingresar dato
varianza=3.6/sqrt(9) # Ingresar dato
ValorProb =10 # Ingresar dato

#####################################################################

prob=pnorm( ValorProb, media, varianza, lower.tail = TRUE) 
normal_area(mean = media, sd = varianza, ub =ValorProb , acolor = rgb(0, 0, 1, alpha = 0.5))
y_coor=pnorm(media, media, varianza, lower.tail = TRUE)/2
text(x = media, y = y_coor,label = paste0("P-valor: ",round(prob,4)))

```

-   **Paso 4:** Presetamos el resultado

Como la función declarada siempre arroja la $P(X<x_0)$, entonces, si deseamos encontrar el resultado para este ejemplo en particular, debemos calcular el complemento de esta probabilidad, esto es:

$$P(X>x_0) = 1- P(X<x_0)$$

Por lo tanto, la probabilidad de que la media muestra sea mayor que 10% es:

$$P(X>10) = 1- P(X<10)$$ $$P(X>10) = 1- 0.0334$$ $$P(X>10) = 0.9666$$

#### 5.1.3.2 Ejemplo 2

Suponga que de una población normal con media 20 se toma una muestra de 16. Si la desviación estándar muestral es 4, encuentre la probabilidad de que la media muestra sea estrictamente menor que 21.735.

**Datos**

Media muestral: 20

Desviación: 4

n: 16

Distribución: Normal

**Solución**

-   **Paso 1**: revisamos los supuestos, esto es:

-   La distribución de probabilidad es normal? : **Si**

-   La varianza poblacional es conocida? : **No**

-   El tamaño de la muestra es grande: **No**

Por lo tanto, suponemos que $\overline{x}$ se distribuye con una t-student con $n-1$ grados de libertad:

$$ t = \frac{\overline{x}-\mu_{\overline{x}}}{\sigma_{\overline{x}}}$$ - **Paso 2**: Construimos la probabilidad solicitada, esto es:

$$P(X<21.735)$$

```{r Ejemplo2, echo=TRUE}

#Ejemplo 2

media=20 # Ingresar dato
varianza=4/sqrt(16) # Ingresar dato
ValorProb =21.735 # Ingresar dato
Grados_libertad= 16-1 #Ingresar dato


#####################################################################
prob=pt(ts(ValorProb,media,varianza),Grados_libertad,lower.tail = TRUE)
normal_area(mean = media, sd = varianza, ub =ValorProb , acolor = rgb(0, 0, 1, alpha = 0.5))
y_coor=pt(ts(media,media,varianza),Grados_libertad,lower.tail = TRUE)/2
text(x = media, y = y_coor,label = paste0("P-valor: ",round(prob,4)))

```

-   **Paso 4:** Presetamos el resultado

Como la función declarada siempre arroja la $P(X<x_0)$, entonces, la probabilidad de que la media muestra sea estrictamente menor que 21.735 es:

$$P(X<27.735)=0.9484$$

#### 5.1.3.3 Ejercicios propuestos

-   Un fabricante declara que la duración de las bujías que el fabrica sigue una distribución normal con una media de 36000 kilómetros y una desviación estándar de 4000 kilómetros. Para una muestra aleatoria de dieciséis bujías, se obtuvo una duración media de 34500 km. Si a afirmación del fabricante es correcta, ¿ cuál es la probabilidad de obtener una media muestral tan pequeña como esta o menor?

-   Un estudio de tránsito revela que el numero promedio de ocupantes de un auto es 1.75. En una muestra de 50 autos con desviación estándar 0.65, seleccionada de una población norma, encuentre la probabilidad de que un numero promedio de ocupante sea mayor que 2.

-   Una muestra aleatoria de seis autos de un determinado modelo evidencia que cada uno de ellos consume las siguientes cantidades en kilómetros por litro:

    ```         
                            18.6     18.4    19.2     20.8    19.4      20.5
    ```

    Determine la probabilidad de que el consumo de gasolina medio muestral de automóviles sea menor que 17.6km por litro, suponiendo que la distribución de la población es normal con media 17.

-   En una fábrica de chocolates llamada "Sweet Delights", el equipo de calidad está llevando a cabo un estudio sobre el peso de las barras de chocolate producidas en una máquina específica. El equipo está interesado en determinar la distribución del peso medio de las barras de chocolate tomadas de muestras aleatorias de la producción diaria. Se sabe que el peso de las barras de chocolate sigue una distribución normal con una media poblacional de 100 gramos y una desviación estándar poblacional de 5 gramos. Supongamos que el equipo de calidad ha tomado una muestra aleatoria de 25 barras de chocolate hoy. Calcule la probabilidad de que el peso medio de estas barras de chocolate esté entre 98 y 102 gramos.

## 5.2 Distribución muestral de la diferencia de medias

::: {style="text-align:center"}
![](images/DIF.png){width="577"}
:::

### 5.2.1 Muestras Dependientes (Pareadas)

De manera general, si se toma una muestra aleataoria de $n$ pares de observaciones representradas por $(x_1,y_1), (x_2,y_2), ... , (x_n,y_n)$,procedentes de dos poblaciones con medias $\mu_1$ y $\mu_2$. De modo que,$x_1, x_2, ... , x_n$ corresponden a las observaciones muestrales de una población con media $\mu_1$ mientras que $y_1, y_2, ... , y_n$ corresponden a las observaciones muestrales de una población con media $\mu_2$.

Ahora bien, si $d_i= x_i-y_i$, para cada $i=1,...,n$, entonces, la diferencias $d_1, d_2, ... d_n$ se pueden pensar como una muestra aleatoria de la población de diferencias de datos pareados. Con esto tenemos que si $\overline{x}$y $\overline{y}$ son las medias muestrales $x_1, x_2, ... , x_n$ y $y_1, y_2, ... , y_n$, entonces,la media $\overline{d}$ de las diferencias muestrales viene dada por $\overline{d}=\overline{x}-\overline{y}$ con lo cual lo podemos asociar con un estadístico $\overline{D}$, definido como la diferencia de medias muestrales $\overline{D}=\overline{X}-\overline{Y}$.

En este sentido la media y varianza que se utilizan en este casos son:

|               Estadístico                |               Media               |                  Varianza                   |
|:-------------------------:|:---------------------:|:---------------------:|
| $\overline{D}=\overline{X}-\overline{Y}$ | $\mu_{\overline{D}}= \mu_1-\mu_2$ | $\sigma_{\overline{D}}^2=\frac{s_{d}^2}{n}$ |

Por lo tanto, la distribución muestral de $\overline{D}$ es la $t$ de Student con $n-1$ grados de libertad. Su expresión esta dada por:

$$t=\frac{\overline{D}-\mu_{\overline{D}}}{\sigma_{\overline{D}}^2}$$\

#### 5.2.1.1 Ejemplo 3

Se recoge datos de consumo de gasolina correspondiente a una muestra aleatoria de 8 automoviles colombianos de dos modelos diferentes. Se forman pares con las dos muestras y cada elemento de un determinado par fue conducido por la misma ruta y por el mismo piloto.

|                |      |      |      |      |      |      |      |      |
|:--------------:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
| $x_i$ (auto A) | 19.4 | 18.8 | 20.6 | 17.6 | 19.2 | 20.9 | 18.3 | 20.4 |
| $y_i$ (auto B) | 19.6 | 17.5 | 18.4 | 17.5 | 18.0 | 20.0 | 18.8 | 19.2 |

-   Determine la media y la desviación muestral de las diferencias en el consumo de gasolina.

-   Suponiendo que la distribución de la diferencial poblacional es normal con media -0.871, encuentre que el consumo promedio de gasolina del auto A sea mayor que el auto B.

**Solución**

Empezamos por calcular la direncia entre las muestras pareadas, esto es:

```{r Ejemplo3, echo=TRUE}

#Ejemplo 3

xi=c(19.4,18.8,20.6,17.6,19.2,20.9,18.3,20.4)
yi=c(19.6,17.5,18.4,17.5,18.0,20.0,18.8,19.2)


#diferencia de muestras
d=xi-yi
d
```

Segundo, calculamos la media de las diferencias, esto es:

$$\overline{d}= \frac{d_1+ ... + d_n}{n}$$

```{r Ejemplo31, echo=TRUE}

#promedio

dprom=mean(d)
dprom

```

Tercero, Calculamos la desviación, esto es:

$$s_d= \sqrt{\frac{\sum d_i^2- n\overline{d}}{n-1}}$$

```{r Ejemplo32, echo=TRUE}

#Desviación

ddes=sd(d)
ddes

```

Ahora bien, para encontrar la $P(\overline{X_A}-\overline{X_B}>0)$. Hallamos $\overline{D}=\overline{X_A}-\overline{X_B}$. Por otra parte tenemos como dato que, la diferencial poblacional es normal con media $\mu_{\overline{D}}=-0.871$. Y la desviación de la media muestral es:

$$\sigma_{\overline{D}}=\frac{s_d}{\sqrt{n}}$$ Reemplazando los datos, tenemos que:

$$\sigma_{\overline{D}}=0.3413$$

```{r Ejemplo33, echo=TRUE}

#Desviación

dm=ddes/sqrt(8)
dm

```

Entonces, encontramos que,

$$P(\overline{X_A}-\overline{X_B}>0)= P(\overline{D}>0) = P(t>\frac{0-\mu_{\overline{D}}}{\sigma_{\overline{D}}})$$ $$P(\frac{0-(-0.807)}{0.319})= P(t>2.526) = 1-P(t<2.526)$$ $$P(\overline{X_A}-\overline{X_B}>0)=1-0.9803=0.0197 \approx 0.02$$

```{r Ejemplo34, echo=TRUE}

#Ejemplo 2

media=-0.807 # Ingresar dato
varianza=0.903/sqrt(8) # Ingresar dato
ValorProb =0 # Ingresar dato
Grados_libertad= 8-1 #Ingresar dato


#####################################################################
prob=pt(ts(ValorProb,media,varianza),Grados_libertad,lower.tail = TRUE)
normal_area(mean = media, sd = varianza, ub =ValorProb , acolor = rgb(0, 0, 1, alpha = 0.5))
y_coor=pt(ts(media,media,varianza),Grados_libertad,lower.tail = TRUE)/2
text(x = media, y = y_coor,label = paste0("P-valor: ",round(prob,4)))

```

Por lo tanto, la probabilidad de que el consumo promedio de gasolina del auto A sea mayor que el auto B es aproximadamente 0.02.

#### 5.2.1.2 Ejercicios propuestos

-   En una línea de producción de alimentos envasados, se están evaluando dos métodos de sellado para bolsas de snacks. Se toma una muestra de 15 bolsas y se sella cada bolsa utilizando ambos métodos en diferentes partes de la bolsa. Después de realizar pruebas de integridad del sellado, se registra el número de bolsas que presentan fugas en cada método. Calcular la probabilidad de que la diferencia media en el número de bolsas con fugas entre los métodos de sellado sea menor que 1 bolsa. Supongamos que la diferencia media poblacional en el número de bolsas con fugas es de $\mu_{\overline{D}}=0.8$.

|     |      |      |      |      |      |      |      |      |      |      |      |      |      |      |      |
|-----|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| M1  | 1.65 | 0.78 | 0.36 | 0.09 | 0.94 | 1.26 | 0.71 | 0.87 | 1.13 | 1.21 | 1.03 | 1.04 | 1.46 | 0.20 | 0.71 |
| M2  | 0.99 | 1.64 | 0.93 | 0.65 | 0.93 | 0.44 | 1.08 | 1.45 | 1.23 | 1.14 | 0.31 | 0.85 | 0.69 | 1.04 | 0.41 |

-   En una planta de producción de productos químicos, se están comparando dos métodos de fabricación para un nuevo producto. Se toma una muestra de 12 lotes de productos fabricados utilizando cada método. Después de realizar pruebas de calidad, se registra la concentración promedio de un componente clave en cada lote. Calcular la probabilidad de que la diferencia media en la concentración de componente clave entre los lotes fabricados con el primer método y los fabricados con el segundo método sea mayor que 0.1%. Supongamos que la diferencia media en la concentración del componente clave es de $\mu_{\overline{D}}=0.05\%$.

    |     |      |      |      |      |      |      |      |      |      |      |      |      |
    |:---:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|
    | L1  | 0.09 | 0.04 | 0.08 | 0.07 | 0.03 | 0.07 | 0.07 | 0.04 | 0.03 | 0.09 | 0.04 | 0.07 |
    | L2  | 0.06 | 0.07 | 0.05 | 0.08 | 0.08 | 0.05 | 0.02 | 0.05 | 0.05 | 0.03 | 0.08 | 0.05 |

### 5.2.1 Muestras independientes 

## 5.3 Intervalos de confiaza para diferencias de medias
